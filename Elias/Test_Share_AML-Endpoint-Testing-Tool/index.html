<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>TKI - Project</title>
	<link rel="stylesheet" href="static\css\design.css">
	<link rel="icon" href="images\ico_script.ico">
	<!--SCRIPTS-->
	<script src="static\js\dragAndDrop.js"></script>
	<script src="static\js\date.js"></script>
	<script src="static\js\showSidebar.js"></script>
	<!-- Footer immer sichtbar -->
	<!-- Seiten Link / Rechts weiß -->
	<!-- Navigationscontainer transparent / keine Farbe -->
	<!-- Navigation komplett weg -->
	<!-- Protype same line as content div -->
	<!-- Andere Farbwahl -->
	<!-- Maria viel Kritik, aber keine Lösung -->
</head>
<body>
	<!--BANNER LEFT-->
	<div class="bannerleft">
		<a href="https://www.hs-mittweida.de/" target="blank"><img alt="logo_hsmw" src="images\logo_hsmw_white.png" width="80%" class="needspace"></img></a>
	</div>
	<!--BANNER RIGHT-->
	<div class="bannerright">
		<!----------DATE TODAY---------->
		<br><span class="white" id="datumsausgabe"></span><br>
		<span class="white" id="datumsausgabe2"></span>
		<script type="text/javascript">berechne();</script><!--Activating the Function "berechne"-->
		<br>
		<div class="space"></div>
		<div class="imglinks">
			<a alt="Google Docs" href="https://docs.google.com/spreadsheets/" target="_blank"><img class="showimg" alt="home" src="static\images\Logo_GoogleDocs.jpg" ></img></a>
			<br><br><br>
			<a alt="ChatGPT" href="https://chat.openai.com/" target="_blank"><img class="showimg" alt="ChatGPT" src="static\images\logo_ChatGPT.png"></img></a>
			<br><br><br><br><br><br>
		</div>
	</div>
	<!--Banner MIDDLE-->
	<div class="banner"><br>
		<!--<hr width="100%" class="b1"></hr><br>-->
		<!--LINKS TO ALL SITES-->
		<ul>
			<li><p></li>
			<li><p>&nbsp;&nbsp;</li>
			<a href="index.html"><p class="fontlogo">TKI Project<br>Prototype</p><br></a>
			<li><p></li>
			<li><p></li>
			<li><a class="white active" href="templates\index.html">Testing</a><!--ACTIVE--></li>
			<!--<div class="dropdown">
				<li class="dropbtn">
					<a href="s2.html">Test</a>
					<div id="myDropdown" class="dropdown-content">
						<div class="boxinvi">
							<a class="white" href="s2.html">Test 1</a><br>
							<a class="white" href="s1.html">Test 2</a>
						</div>
					</div>
				</li>
			</div>
			-->
			<li><button class="buttinvi1" id="a" onclick="toggleError(this)"><img id="icon" class="icon blasha" alt="visibility" src="static\images\icon_eye_closed.svg"></button></li>
		</ul>
		<!--END LINKS TO ALL SITES-->
		<br><br>
	</div>
	<!--SITE CONTENT--> 
	<div class="content">
		<!-- BOX OBEN LINKS -->
		<br><br>
		<div class="zoneImgDetected" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)">
			<img id="detected-image" src="" alt="Detected Image" style="display:none;" class="previewImg">
		</div>
		<!-- BOX OBEN RECHTS -->
		<div class="zoneResults" id="results">
			<table>
				<tr>
					<th style="background-color:black;">
						<p>YOLO Analyse: <span id="yolo-status">Noch nicht gestartet</span></p>
						<p id="yolo-spinner" style="display:none;">Lädt...</p>
					</th>
				</tr>
				<tr>
					<td class="testTD">
						<!-- Textausgabe der YOLO-Analyse -->
						<div id="detection-info">
							<!--Erkannte Objekte:-->
							<ul id="detected-objects-list">
							</ul> <!-- Hier werden die erkannten Objekte angezeigt -->
						</div>
					</td>
				</tr>
				<tr><td>Verarbeitungszeit:<span id="yolo-processing-time"></span><span id="imageSize"></span> <!-- Hier wird die Verarbeitungszeit angezeigt --></td></tr>
				<tr><td style="	border: 2px solid transparent;"></td></tr>
			</table>
		</div>
		<!-- BOX UNTEN RECHTS -->
		<div class="zoneOCR">
			<table>
				<tr>
					<th style="background-color:black;">
						<p>OCR Analyse: <span id="ocr-status">Noch nicht gestartet</span></p>
						<p id="ocr-spinner" style="display:none;">Lädt...</p>
					</th>
				</tr>
				<tr>
					<td>
						<!-- Textausgabe der YOLO-Analyse -->
						<div id="ocr-info">
							<!--Erkannter Text:-->
							<ul id="ocr-text-list"></ul> <!-- Hier werden OCR-Ergebnisse angezeigt -->
						</div>
					</td>
				</tr>
				<tr><td>Verarbeitungszeit:<span id="ocr-processing-time"></span><!-- Hier wird die Verarbeitungszeit angezeigt --></td></tr>
			</table>
		</div>
		<script>
			function dropHandler(event) {
				event.preventDefault();
				event.currentTarget.classList.remove('hover');

				if (event.dataTransfer.items) {
					const file = event.dataTransfer.items[0].getAsFile();
					if (file && file.type.startsWith('image/')) {
						displayImage(file);
						uploadImage(file);
					} else {
						alert("Bitte ein Bild-Dateiformat ziehen.");
					}
				}
			}

			function uploadImage(file) {
				const formData = new FormData();
				formData.append('file', file);
				
				// Anzeige der Ladeanzeigen
				document.getElementById('yolo-status').textContent = 'In Bearbeitung...';
				document.getElementById('ocr-status').textContent = 'In Bearbeitung...';
				document.getElementById('yolo-spinner').style.display = 'block';
				document.getElementById('ocr-spinner').style.display = 'block';

				// Zeige das Originalbild an
				const img = document.getElementById('detected-image');
				img.src = URL.createObjectURL(file);  // Originalbild anzeigen
				img.style.display = 'block';
	
				fetch('/upload', {
					method: 'POST',
					body: formData
				})
				.then(response => response.json())
				.then(data => {
				// Ersetze das Bild mit den Bounding Boxes
				const img = document.getElementById('detected-image');
				img.src = data.marked_image_path;  // Markiertes Bild anzeigen
				img.style.display = 'block';  // Das Bild sichtbar machen

					// Erkannte Objekte anzeigen
					const detectedObjectsList = document.getElementById('detected-objects-list');
					detectedObjectsList.innerHTML = '';

					if (data.detected_objects.length === 0) {
						const li = document.createElement('li');
						li.textContent = "Keine Objekte erkannt.";
						detectedObjectsList.appendChild(li);
					} else {
						data.detected_objects.forEach(obj => {
							const li = document.createElement('li');
							const confidenceRounded = (obj.confidence * 100).toFixed(2);
							li.textContent = `${obj.class} (Confidence: ${confidenceRounded}%)`;
							detectedObjectsList.appendChild(li);
						});
					}

					// OCR-Ergebnisse anzeigen
					const ocrTextList = document.getElementById('ocr-text-list');
					ocrTextList.innerHTML = '';

					if (data.detected_texts.length === 0) {
						const li = document.createElement('li');
						li.textContent = "Kein Text erkannt.";
						ocrTextList.appendChild(li);
					} else {
						data.detected_texts.forEach(item => {
							const li = document.createElement('li');
							li.textContent = `${item.text} (Confidence: ${item.confidence}%)`;
							ocrTextList.appendChild(li);
						});
					}

					// Verarbeitungszeit anzeigen
					document.getElementById('yolo-processing-time').textContent = " " + data.yolo_processing_time + " Sekunden" || '-';
					document.getElementById('ocr-processing-time').textContent = " " + data.ocr_processing_time + " Sekunden" || '-';

					// Status aktualisieren
					document.getElementById('yolo-status').textContent = 'Abgeschlossen';
					document.getElementById('ocr-status').textContent = 'Abgeschlossen';
					document.getElementById('yolo-spinner').style.display = 'none';
					document.getElementById('ocr-spinner').style.display = 'none';
				})
				.catch(error => {
					console.error('Fehler:', error);
					document.getElementById('yolo-status').textContent = 'Fehler';
					document.getElementById('ocr-status').textContent = 'Fehler';
					document.getElementById('yolo-spinner').style.display = 'none';
					document.getElementById('ocr-spinner').style.display = 'none';
				});
		}

	function dragOverHandler(event) {
		event.preventDefault();
		event.currentTarget.classList.add('hover');
	}

	function dragLeaveHandler(event) {
		event.preventDefault();
		event.currentTarget.classList.remove('hover');
	}
		</script>
	</div>
	
<footer>
	<a href="impressum.html"><p class="ftext">Impressum</p></a>
</footer>

</body>

</html>
